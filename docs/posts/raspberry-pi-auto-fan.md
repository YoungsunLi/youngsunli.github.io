# æ ‘è“æ´¾æ¸©æ§æ•£çƒ­é£æ‰‡
æ ¹æ®æ ‘è“æ´¾ SoC çš„æ¸©åº¦æ™ºèƒ½è‡ªåŠ¨æ§åˆ¶é£æ‰‡çš„å¼€å…³, æ»¡è¶³æ¡ä»¶: å½“æ¸©åº¦è¿‡é«˜æ˜¯å¼€å¯é£æ‰‡, æ¸©åº¦é€‚å®œæ—¶å…³é—­é£æ‰‡.

## è·å–SoCå®æ—¶æ¸©åº¦
é€šè¿‡è¯»å– `/sys/class/thermal/thermal_zone0/temp` å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ¸©åº¦å€¼, æ ¹æ®[RaspberryPiå®˜æ–¹æ–‡æ¡£](https://www.raspberrypi.org/documentation/hardware/raspberrypi/frequency-management.md)ä»‹ç», 
å¹¶æ²¡æœ‰ç‹¬ç«‹ç›‘æ§ CPU æ¸©åº¦æˆ–è€… GPU æ¸©åº¦çš„ä¼ æ„Ÿå™¨, æ‰€ä»¥é€šè¿‡è¯¥æ–‡ä»¶è·å–åˆ°çš„æ¸©åº¦å®é™…ä¸Šæ˜¯æ•´ä¸ª SoC èŠ¯ç‰‡çš„æ¸©åº¦; ä½†æ˜¯ CPU å’Œ GPU éƒ½åœ¨è¿™ä¸ªèŠ¯ç‰‡ä¸Š, æ‰€ä»¥æˆ‘ä»¥è¿™ä¸ªæ¸©åº¦ä½œä¸ºæ¸©æ§é˜ˆå€¼å‚è€ƒ.

#### é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰SoCæ¸©åº¦(ç»“æœé™¤ä»¥1000, å•ä½/â„ƒ)
```shell script
pi@raspberrypi:~ $ cat /sys/class/thermal/thermal_zone0/temp
42425
```

## é£æ‰‡ä¾›ç”µé—®é¢˜
### å¯ä»¥é€šè¿‡ GPIO é’ˆè„šç›´æ¥ä¾›ç”µé©±åŠ¨å—?
**æˆ‘ä»¬æ— æ³•ç›´æ¥é€šè¿‡ GPIO æ¥é©±åŠ¨é£æ‰‡å¹¶æ§åˆ¶å®ƒçš„å¼€å…³,** å› ä¸ºæ ¹æ®[RaspberryPiå®˜æ–¹FAQæ–‡æ¡£](https://www.raspberrypi.org/documentation/faqs/#pi-power)ä»‹ç», 
GPIO çš„è¾“å‡ºç”µå‹æ˜¯ 3.3V, å¹¶ä¸”å®‰å…¨çš„æœ€é«˜ç”µæµè¾“å‡ºæ˜¯ 16mA, å³°å€¼ä¸º50mA, æŸäº› GPIO é’ˆè„šé»˜è®¤è¾“å‡º 8mA; æ‰€ä»¥å³ä½¿ä½ çš„é£æ‰‡é¢å®šç”µå‹ä¸º 3V, è¿™ä¹ˆå°çš„ç”µæµä¹Ÿéš¾ä»¥é©±åŠ¨å®ƒ, å³ä½¿èƒ½é©±åŠ¨ä¹Ÿä¸æ¨èè¿™ä¹ˆå¹², ä¸€ä¸ªåŸå› æ˜¯å¯èƒ½ä¼šæŸåæ ‘è“æ´¾, 
æ ¹æ®[RaspberryPiå®˜æ–¹GPIOä½¿ç”¨æ–‡æ¡£](https://www.raspberrypi.org/documentation/usage/gpio/README.md)æ˜ç¡®çš„è­¦å‘ŠæŒ‡å‡º, ä¸èƒ½å°†ç”µæœºç›´æ¥æ¥åœ¨ GPIO é’ˆè„šä¸Š(é£æ‰‡å®é™…ä¸Šå°±æ˜¯ç”±ç”µæœºé©±åŠ¨çš„), å¦ä¸€ä¸ªæ˜¯é€šè¿‡è¿™ä¹ˆå°ç”µæµé©±åŠ¨çš„é£æ‰‡çœŸçš„èƒ½èµ·åˆ°æ•£çƒ­ä½œç”¨å—? 

### é€šè¿‡ 5V é’ˆè„šæˆ–è€… 3V3 é’ˆè„šä¾›ç”µ
[Pinout 5Vé’ˆè„šæ–‡æ¡£](https://pinout.xyz/pinout/pin2_5v_power)ä¸­æŒ‡å‡ºæ ‘è“æ´¾çš„ 5V é’ˆè„šæ˜¯ç›´æ¥è¿é€šåˆ°ç”µæºçš„, ä½¿ç”¨ 5V é’ˆè„šç›¸å½“äºä¸æ ‘è“æ´¾å¹¶è”ä½¿ç”¨ä¸€ä¸ªç”µæºé€‚é…å™¨, æ‰€ä»¥æ ¹æ® "å¹¶è”åˆ†æµ" è¯¥é’ˆè„šèƒ½æä¾›çš„ç”µæµå®é™…ä¸Šå°±ç­‰äº:
 `(ç”µæºé€‚é…å™¨çš„é¢å®šæœ€é«˜ç”µæµ) - (æ ‘è“æ´¾æœ¬èº«è¿è¡Œæ‰€å ç”¨çš„ç”µæµ)`, æ‰€ä»¥å‡è®¾ä½ ä½¿ç”¨ç¬¦åˆè¦æ±‚çš„ç”µæºé€‚é…å™¨, 5V é’ˆè„šæ˜¯å®Œå…¨å¯ä»¥ç›´æ¥é©±åŠ¨é¢å®šç”µå‹ä¸º 5V çš„é£æ‰‡.  
è€Œæ ‘è“æ´¾çš„ 3V3 é’ˆè„š, [Pinout 3V3é’ˆè„šæ–‡æ¡£](https://pinout.xyz/pinout/pin1_3v3_power)ä¸­ä¹ŸæŒ‡å‡ºäº†åœ¨å‹å· B+ ä¹‹å‰çš„ç”µæµæœ€é«˜èƒ½æä¾› 50mA, ä½†æ˜¯åœ¨ B+ ä¹‹åçš„æ ‘è“æ´¾, 3V3 é’ˆè„šåˆ™å¯ä»¥æä¾›é«˜è¾¾ 500mA çš„ç”µæµ; 
æ‰€ä»¥å½“ä½¿ç”¨é¢å®šç”µå‹ä¸º 3V çš„é£æ‰‡æ—¶, ä½¿ç”¨ 3V3 é’ˆè„šä¹Ÿæ˜¯å¯ä»¥ç›´æ¥å®‰å…¨çš„é©±åŠ¨é£æ‰‡æ»´.


## å¦‚ä½•æ§åˆ¶é£æ‰‡çš„å¼€å…³?
å½“ç›´æ¥å°†é£æ‰‡æ¥åˆ°åˆé€‚çš„ç”µæºä¸Š, é£æ‰‡æ˜¯å§‹ç»ˆå¤„äºè¿è¡ŒçŠ¶æ€. ç°åœ¨æˆ‘éœ€è¦æ ¹æ® SoC çš„æ¸©åº¦æ¥è‡ªåŠ¨æ§åˆ¶å®ƒçš„å¼€å…³, æ‰€ä»¥å¯ä»¥é€šè¿‡ç»™**é£æ‰‡ä¸ç”µæºè¿æ¥ä¹‹é—´åŠ ä¸€ä¸ªå¼€å…³**, ç„¶åé€šè¿‡æŸä¸€ä¸ª **GPIO é’ˆè„šæ§åˆ¶è¯¥å¼€å…³**, è€Œå¯¹è¯¥ GPIO é’ˆè„šçš„æ§åˆ¶åˆ™å¯ä»¥é€šè¿‡ä»£ç **è·å– SoC çš„æ¸©åº¦**, 
å¹¶æ ¹æ®**åˆ¤æ–­æ¸©åº¦é˜ˆå€¼å¯åœ**ä¹Ÿå°±æ˜¯å¼€æˆ–è€…å…³é£æ‰‡. æœ€ç»ˆå®ç°å¯¹é£æ‰‡çš„è‡ªåŠ¨å¼€å…³æ§åˆ¶.

### ä½¿ç”¨ä¸‰æç®¡ä½œä¸ºé£æ‰‡å¼€å…³
é€‰ç”¨åˆé€‚çš„ä¸‰çº§ç®¡,å½“å®ƒä»…å·¥ä½œåœ¨ **æˆªæ­¢çŠ¶æ€** å’Œ **é¥±å’ŒçŠ¶æ€** æ—¶, é‚£ä¹ˆè¯¥ä¸‰æç®¡å°±å¯ä»¥æ˜¯è§†ä½œä¸ºä¸€ä¸ªå¼€å…³.

### ä½¿ç”¨ Python æ§åˆ¶é£æ‰‡
ä½¿ç”¨ä»¥ä¸‹ä»£ç æ—¶, ä½ æœ€æœ‰å¯èƒ½ä¿®æ”¹çš„æ˜¯é«˜äº®éƒ¨åˆ†çš„ä»£ç 
#### auto_fan.py
```python {8,9,10}
#!/usr/bin/python
# -*- coding: utf-8 -*-
from RPi import GPIO
from time import sleep

GPIO.setmode(GPIO.BCM) # ä½¿ç”¨BCMå¼•è„šæ¨¡å¼

channel = 17    # ä½¿ç”¨BCM17(å¯¹åº”ç‰©ç†å¼•è„šå·11)æ¥å£æ§åˆ¶å¼€å…³
start_temp = 55 # å¯åŠ¨é£æ‰‡çš„æ¸©åº¦é˜ˆå€¼(â„ƒ)
end_temp = 48   # å…³é—­é£æ‰‡çš„æ¸©åº¦é˜ˆå€¼(â„ƒ)

GPIO.setup(channel, GPIO.OUT, initial = GPIO.LOW) # åˆå§‹åŒ–æ§åˆ¶å¼•è„š
is_high = GPIO.LOW # ç”¨äºæ ‡è®°é£æ‰‡æ˜¯å¦æ‰“å¼€ é¿å…é¢‘ç¹è°ƒç”¨output

try:
    while True:
        # è·å–å½“å‰SoCæ¸©åº¦
        temp = open('/sys/class/thermal/thermal_zone0/temp')
        temp = int(temp.read()) / 1000

        if temp > start_temp and not is_high: # å½“SoCæ¸©åº¦è¶…è¿‡å¯åŠ¨é˜ˆå€¼ä¸”é£æ‰‡å¤„äºå…³é—­çŠ¶æ€
            GPIO.output(channel, GPIO.HIGH)   # æ‰“å¼€é£æ‰‡
            is_high = GPIO.HIGH               # æ ‡è®°é£æ‰‡çŠ¶æ€ä¸ºæ‰“å¼€

        elif temp < end_temp and is_high:     # å½“SoCæ¸©åº¦ä½äºå…³é—­é˜ˆå€¼ä¸”é£æ‰‡å¤„äºæ‰“å¼€çŠ¶æ€
            GPIO.output(channel, GPIO.LOW)    # å…³é—­é£æ‰‡
            is_high = GPIO.LOW                # æ ‡è®°é£æ‰‡çŠ¶æ€ä¸ºå…³é—­

        sleep(10) # æ¯éš”10ç§’ç›‘æ§ä¸€æ¬¡
except:
    pass
# é€€å‡ºæ—¶ é‡ç½®è¯¥å¼•è„š
GPIO.cleanup(channel)
```
::: tip å…³äºé˜ˆå€¼çš„é€‰å–
è¿™ä¸ªèŒƒå›´æ ¹æ®è‡ªå·±çš„å–œæ¬¢å¯ä»¥è‡ªè¡Œå†³å®š, æˆ‘è¿™é‡Œé€‰å–æ˜¯æ ¹æ®[RaspberryPiå®˜æ–¹æ–‡æ¡£](https://www.raspberrypi.org/documentation/hardware/raspberrypi/frequency-management.md)å¯¹è¿‡çƒ­ä¿æŠ¤æ§åˆ¶çš„æªæ–½å†³å®šçš„.   
ç¡¬é™åˆ¶ä¸º 85â„ƒ, è¿™ä¸ªæ¸©åº¦å¤ªé«˜äº†, æˆ‘ä¸å¸Œæœ›æˆ‘çš„æ ‘è“æ´¾åˆ°è¾¾è¿™ä¸ªæ¸©åº¦æ‰å¯åŠ¨é£æ‰‡.  
è½¯é™åˆ¶ä¸º 60â„ƒ, è¿™ä¸ªæ¸©åº¦çœ‹èµ·æ¥å¯ä»¥æ¥å—.  
æ‰€ä»¥ä¸ºäº†é¿å…æ ‘è“æ´¾è§¦å‘è½¯é™åˆ¶, æˆ‘é€‰å–ä¸€ä¸ªæ¥è¿‘ 60â„ƒ ä½†åˆä¸ä¼šè¿…é€Ÿè¾¾åˆ° 60â„ƒ çš„æ¸©åº¦ 55â„ƒ; è¿™æ˜¯å¯åŠ¨é£æ‰‡çš„æ¸©åº¦, 
ä¸ºäº†é¿å…é£æ‰‡é¢‘ç¹çš„åœ¨é˜ˆå€¼è¾¹ç•Œå¼€å¼€å…³å…³, å…³é—­é£æ‰‡çš„æ¸©åº¦å¯ä»¥æ¯”å¯åŠ¨é£æ‰‡çš„æ¸©åº¦ä½å‡ åº¦, æˆ‘è¿™é‡Œé€‰å– 48â„ƒ.
:::

## ä¸‹é¢è¿›è¡Œå®æµ‹
### å®é™…ç”¨åˆ°çš„è®¾å¤‡å’Œå…ƒå™¨ä»¶:
- RaspberryPi 4B
- 2ä¸ª 5V/100mA æ•£çƒ­é£æ‰‡
- NPN ä¸‰æç®¡ 2N5551

è¿™ä¸ª `2N5551` æ˜¯æˆ‘éšä¾¿ä»ç§¯ç°çš„é›¶ä»¶å·¥å…·ç®±é‡Œéšæ‰‹ç¿»å‡ºæ¥çš„, é’ˆè„šéƒ½æœ‰ç‚¹ç”Ÿé”ˆäº†(çœŸçš„å¾ˆéšä¾¿, æ‘¸åˆ°å“ªä¸ªç”¨å“ªä¸ª, æ‹¿çš„æ—¶å€™å•¥å‹å·ä¹Ÿæ²¡æ³¨æ„çœ‹, æ˜¯ä¸‰æç®¡å°±è¡ŒğŸ˜‚).  
![2N5551](../img/raspberrypi4b-fan-2n5551.jpg)

### æ¥çº¿å‡†å¤‡
#### é’ˆè„šè°ƒæ•´
æˆ‘è¦åœ¨é£æ‰‡è´Ÿæä¸ŠåŠ è£…ä¸‰æç®¡å¼€å…³, å¹¶å¸Œæœ›è´Ÿæä¸ç”¨äºæ§åˆ¶çš„ GPIO æ¥å£ç›¸é‚», æ‰€ä»¥æˆ‘æŠŠæ­£ææŠ½å‡ºæ¥, å¹¶ä¸å¦ä¸€æ¡ç›¸åŒæ¥å¤´çš„æœé‚¦çº¿äº¤æ¢æ¥å¤´; å¾—åˆ°è´Ÿæä¸ GPIO ç›¸é‚»åŒ pin æ¥å¤´, æ­£æç‹¬ç«‹å• pin æ¥å¤´. å¦‚ä¸‹å›¾æ‰€ç¤º:  
![æ­£æä¸ç”¨äº GPIO æ§åˆ¶çš„æœé‚¦çº¿äº¤æ¢](../img/raspberry-pi-auto-fan_0.jpg)

#### åœ¨è´Ÿæä¸ŠåŠ è£…ä¸‰æç®¡
::: tip NPNä¸‰æç®¡é’ˆè„šè¯†åˆ«
æœ‰å­—çš„ä¸€é¢æ­£å¯¹è‡ªå·±, å¼•è„šå‘ä¸‹, ä¸‰è·Ÿå¼•è„šä»å·¦åˆ°å³åˆ†åˆ«æ˜¯:  
E-å‘å°„æã€B-åŸºæã€C-é›†ç”µæ.  
![TO-92å°è£…](../img/raspberry-pi-auto-fan_1.png)
:::

æŠŠè´Ÿæä»ä¸­é—´å‰ªæ–­, å¹¶å°† GPIO çº¿ä¹Ÿå‰ªçŸ­è‡³ä¸€æ ·çš„é•¿åº¦, ç„¶åå°† GPIO çº¿ä¸ä¸‰æç®¡çš„ä¸­é—´å¼•è„šä¹Ÿå°±æ˜¯**B-åŸºæ**è¿æ¥.

::: warning å…³äºä¸‰æç®¡è¿›å…¥é¥±å’ŒçŠ¶æ€æ‰€éœ€çš„ç”µå‹
æŸ¥é˜…èµ„æ–™åå‘ç° `2N5551` çš„é¥±å’ŒçŠ¶æ€ç”µå‹æ˜¯ 1V, è€Œ GPIO çš„è¾“å‡ºç”µå‹æ˜¯ 3.3V, æ‰€ä»¥ç†è®ºä¸Šè¦åœ¨å®ƒä»¬ä¹‹é—´ä¸²è”ä¸€ä¸ªé€‚å½“çš„ç”µé˜»æ¥æ§åˆ¶ç”µå‹, ä½†æ˜¯æˆ‘åœ¨å®é™…é¢åŒ…æ¿æµ‹è¯•ä¸­, å¯¹ `2N5551` çš„åŸºææ¥å…¥ 3.3V ä¸€å®šæ—¶é—´åå¹¶æ²¡æœ‰äº§ç”Ÿå‘çƒ­ç°è±¡, æ‰€ä»¥æœ€ç»ˆé£æ‰‡æ”¹è£…æˆ‘å¹¶æ²¡æœ‰åœ¨å®ƒä»¬ä¹‹é—´åŠ è£…ç”µé˜».
:::  

ç„¶åå†å°†è´Ÿæå‰ªæ–­çš„ä¸¤ç«¯åˆ†åˆ«æ¥åœ¨ä¸‰æç®¡çš„å·¦å³ä¸¤ç«¯, åˆ†åˆ«æ˜¯**E-å‘å°„æ**å’Œ**C-é›†ç”µæ**;  
ä¿é™©çš„æ¥æ³•æ˜¯ä»é£æ‰‡å‡ºæ¥é‚£æ¡çº¿(å®ƒè™½ç„¶åœ¨é£æ‰‡çš„è´Ÿæ, ä½†æ˜¯å¯¹äºä¸‰æç®¡æ¥è¯´å®ƒå¸¦æ­£ç”µ)æ¥åœ¨**C-é›†ç”µæ**, å¸¦æ¥å¤´ä¸ GPIO çº¿ç›¸é‚»çš„é‚£æ¡çº¿æ¥åœ¨**E-å‘å°„æ**.

::: tip å…³äºä¸‰æç®¡çš„ç”µæµæ–¹å‘
ä½ å¯èƒ½æ³¨æ„åˆ°, æˆ‘çš„æ¥çº¿ä¸ä¸Šè¿°æ˜¯ç›¸åçš„. ç†è®ºä¸Šä¸‰æç®¡é›†ç”µæå’Œå‘å°„æä¹‹é—´çš„ç”µæµæ–¹å‘æ˜¯ä»é›†ç”µææµå‘å‘å°„æ, å¦‚å›¾æ‰€ç¤º:  
![ç”µæµæ–¹å‘](../img/raspberry-pi-auto-fan_3.png)  
ä½†æ˜¯ç”¨ä½œå¼€å…³ä»…å·¥ä½œåœ¨ **æˆªæ­¢çŠ¶æ€** å’Œ **é¥±å’ŒçŠ¶æ€** çš„ä¸‰çº§ç®¡ä¼¼ä¹åœ¨è¿™ä¸ªæ—¶å€™å¯¹ææ€§å¹¶æ²¡æœ‰è¦æ±‚, å› ä¸ºåœ¨é¥±å’ŒçŠ¶æ€ä¸‹, é›†ç”µæè·Ÿå‘å°„æä¹‹é—´ç†è®ºä¸Šæ˜¯ç›¸å½“äºçŸ­è·¯çš„, æ‰€ä»¥æ€ä¹ˆæ¥åº”è¯¥éƒ½æ²¡é—®é¢˜. 
åœ¨æˆ‘å®é™…é¢åŒ…æ¿æµ‹è¯•ä¸­, æ— è®ºæ˜¯æ­£æ¥è¿˜æ˜¯åæ¥, éƒ½å¯ä»¥æ­£å¸¸æ§åˆ¶é£æ‰‡çš„å¼€å…³; æ‰€ä»¥, åœ¨ä¸‹å›¾æ¥çº¿çš„æ—¶å€™ä¹Ÿæ˜¯å¾ˆéšä¾¿çš„éšæ‰‹æŠ“åˆ°å“ªä¸ªçº¿å°±æ¥å“ªæ ¹çº¿ğŸ™ƒ.
:::

![NPN](../img/raspberry-pi-auto-fan_2.jpg)

#### å¯¹çº¿æä»¥åŠæ¥å£å¤„è¿›è¡Œç»ç¼˜å¤„ç†
æˆ‘ä½¿ç”¨çš„æ˜¯çƒ­ç¼©ç®¡  
![ç»ç¼˜å¤„ç†](../img/raspberry-pi-auto-fan_4.jpg)

### å®‰è£…åˆ°æ ‘è“æ´¾4B
å°†é£æ‰‡æ­£ææ¥åˆ°ç‰©ç†é’ˆè„šä½ç½® 2 æˆ–è€… 4 ä¸Š, è¿™ä¸¤ä¸ªéƒ½æ˜¯ 5V; æ ¹æ®ä¹‹å‰å¯¹æ¥å£çš„è°ƒæ•´, é£æ‰‡çš„è´Ÿæè·Ÿ GPIO æ˜¯ç›¸é‚»çš„, æ‰€ä»¥æˆ‘é€‰å–ç‰©ç†æ¥å£ 9(æ¥åœ°/è´Ÿæ) è·Ÿ 11(BCM17)æ’å…¥è¿™ä¸¤æ ¹çº¿.  
![é’ˆè„šè¯´æ˜](../img/raspberry-pi-auto-fan_7.png)


#### ä¸Šæœºæ•ˆæœå›¾
![ä¸Šæœºæ•ˆæœ](../img/raspberry-pi-auto-fan_6.jpg)
![ä¸Šæœºæ•ˆæœ](../img/raspberry-pi-auto-fan_5.jpg)

### è¿è¡Œæ¸©æ§ç¨‹åº auto_fan.py
åœ¨ä½ åˆ›å»ºè¯¥ç¨‹åºçš„ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤: `python auto_fan.py`
```shell script
pi@raspberrypi:~ $ python auto_fan.py
```
åœ¨ä½¿ç”¨å®˜æ–¹ Raspbian æ¡Œé¢ç‰ˆæ—¶æµ‹è¯•é€šè¿‡, å…¶ä»–ç³»ç»Ÿå¯èƒ½ä¼šå‡ºç°ç¯å¢ƒé—®é¢˜. å¯è‡ªè¡Œ Google è§£å†³ğŸ‘Œ

## è¿˜èƒ½åšäº›ä»€ä¹ˆ?
- ä½ å¯ä»¥å°†è¯¥ python ç¨‹åºåŠ å…¥ç³»ç»Ÿè‡ªå¯, æ–¹ä¾¿é‡å¯åä¸ç”¨æ‰‹åŠ¨æ‰§è¡Œ.
- ä½ å¯èƒ½ä¸åªæ˜¯å¸Œæœ›æ§åˆ¶é£æ‰‡çš„å¼€æˆ–è€…å…³, ä½ è¿˜æƒ³æ ¹æ®æ¸©åº¦æ§åˆ¶é£æ‰‡çš„è½¬é€Ÿ?ğŸ˜œ
